<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>청렴 참여형 필터 (WebAR)</title>
  <!-- A-Frame & MindAR (Face Tracking) -->
  <script src="https://unpkg.com/aframe@1.4.1/dist/aframe.min.js"></script>
  <script src="https://unpkg.com/mind-ar/dist/mindar-face-aframe.prod.js"></script>
  <style>
    body{margin:0;background:#000;font-family:system-ui,AppleSDGothicNeo,'Noto Sans KR',sans-serif}
    .ui {position:fixed;left:0;right:0;bottom:0;display:flex;gap:8px;justify-content:center;align-items:center;padding:10px;}
    .btn {background:#06b6d4;color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700}
    .btn.secondary {background:#334155}
    .toast{position:fixed;top:12px;left:50%;transform:translateX(-50%);background:#0f172a;color:#fff;padding:8px 12px;border-radius:8px;font-size:14px;opacity:.9}
    .brand{position:fixed;top:10px;left:10px;color:#fff;font-weight:700;background:rgba(0,0,0,.35);padding:6px 10px;border-radius:8px}
  </style>
</head>
<body>
  <div class="brand">청렴 챌린지</div>
  <div id="toast" class="toast" style="display:none;"></div>

  <!-- WebAR Scene -->
  <a-scene mindar-face="autoStart: true" embedded vr-mode-ui="enabled: false"
           device-orientation-permission-ui="enabled: false">
    <a-assets>
      <!-- 교체할 자산들: /assets 폴더에 파일 넣기 -->
      <img id="logo" src="assets/logo.png" />
      <img id="hash" src="assets/hashtag.png" />
      <img id="t1" src="assets/text1.png" />
      <img id="t2" src="assets/text2.png" />
      <img id="t3" src="assets/text3.png" />
    </a-assets>

    <!-- 카메라/조명 -->
    <a-entity camera position="0 0 0"></a-entity>
    <a-entity light="type: ambient; intensity: 1"></a-entity>

    <!-- Face Anchor: 얼굴 기준으로 요소 붙이기 -->
    <a-entity mindar-face-target="anchorIndex: 168"> <!-- 이마/정면 부근 -->
      <!-- 랜덤 문구: 처음엔 t1 표시, 버튼으로 교체 -->
      <a-plane id="msg" src="#t1" position="0 0.5 -0.5" width="0.9" height="0.25" transparent="true"></a-plane>
      <!-- 로고: 좌상단 느낌 -->
      <a-plane src="#logo" position="-0.45 0.8 -0.5" width="0.25" height="0.1" transparent="true"></a-plane>
      <!-- 해시태그: 하단 중앙 -->
      <a-plane src="#hash" position="0 -0.6 -0.5" width="0.9" height="0.15" transparent="true"></a-plane>
    </a-entity>
  </a-scene>

  <!-- UI 버튼 -->
  <div class="ui">
    <button id="btnNext" class="btn">문구 바꾸기</button>
    <button id="btnShot" class="btn secondary">사진 저장</button>
  </div>

  <script>
    // 랜덤/순환 문구
    const texts = ['#t1','#t2','#t3'];
    let idx = 0;
    const msg = document.querySelector('#msg');
    document.querySelector('#btnNext').addEventListener('click', ()=>{
      idx = (idx + 1) % texts.length;
      msg.setAttribute('src', texts[idx]);
      toast('문구가 변경되었습니다.');
    });

    // 캡처(스크린샷) 저장
    document.querySelector('#btnShot').addEventListener('click', async ()=>{
      try{
        const canvas = document.querySelector('canvas'); // A-Frame 렌더러 캔버스
        const data = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = data; a.download = 'clean-commitment.png'; a.click();
        toast('사진이 저장되었습니다.');
      }catch(e){
        toast('저장이 안 되면 브라우저 권한/HTTPS를 확인해주세요.');
      }
    });

    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.style.display='block';
      setTimeout(()=>{t.style.display='none';}, 1600);
    }
  </script>
</body>
</html>
